<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="narrator">
<title>Descriptive Narratives • narrator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.5/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.5/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Descriptive Narratives">
<meta property="og:description" content="narrator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">narrator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/descriptive.html">Descriptive Narratives</a>
    <a class="dropdown-item" href="../articles/echarts.html">Narrate Echarts Plots</a>
    <a class="dropdown-item" href="../articles/formatting.html">Formatting Output</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/denisabd/narrator/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Descriptive Narratives</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/denisabd/narrator/blob/HEAD/vignettes/descriptive.Rmd" class="external-link"><code>vignettes/descriptive.Rmd</code></a></small>
      <div class="d-none name"><code>descriptive.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://denisabd.github.io/narrator/">narrator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="descriptive-narrative">Descriptive Narrative<a class="anchor" aria-label="anchor" href="#descriptive-narrative"></a>
</h2>
<p>Basic narrative type is descriptive stats, looking into outliers or
biggest contributors to the total volumes in the data set. This
narratives are quite useful and can help to look deeper into the data
set hierarchy.</p>
<div class="section level3">
<h3 id="simple-table">Simple Table<a class="anchor" aria-label="anchor" href="#simple-table"></a>
</h3>
<p>Starting with a simplest table that has only one dimension and one
measure. Here overall sales volume as well as outlying Territories will
be analyzed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_one</span> <span class="op">&lt;-</span> <span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Sales</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_one</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Region</th>
<th align="right">Sales</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">16351889</td>
</tr>
<tr class="even">
<td align="left">EMEA</td>
<td align="right">12918195</td>
</tr>
<tr class="odd">
<td align="left">ASPAC</td>
<td align="right">3450130</td>
</tr>
<tr class="even">
<td align="left">LATAM</td>
<td align="right">2817267</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span><span class="va">df_one</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Outlying Regions by Sales are NA (16.4 M, 46 %), EMEA (12.9 M, 36.4 %).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarization">Summarization<a class="anchor" aria-label="anchor" href="#summarization"></a>
</h3>
<p>There are multiple summarization/aggregation options for the data
frame, controlled by <code>summarization</code> argument that can be
<code>sum</code>, <code>count</code> or <code>average</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>, </span>
<span>    dimensions <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    summarization <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 8,795.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Outlying Regions by Sales are NA (3,776, 39.4 %), EMEA (2,904, 30.3 %).</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>, </span>
<span>    dimensions <span class="op">=</span> <span class="st">"Region"</span>, </span>
<span>    summarization <span class="op">=</span> <span class="st">"average"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; $`Average Sales`</span></span>
<span><span class="co">#&gt; Average Sales across all Regions is 3,553.7.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Outlying Regions by Sales are LATAM (2,056.4, -42.1 % vs average Sales), ASPAC (2,151, -39.5 % vs average Sales).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-dimensions">Multiple Dimensions<a class="anchor" aria-label="anchor" href="#multiple-dimensions"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_two</span> <span class="op">&lt;-</span> <span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Region</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"EMEA"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Region</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Sales</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_two</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Region</th>
<th align="left">Product</th>
<th align="right">Sales</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Food &amp; Beverage</td>
<td align="right">5838736.3</td>
</tr>
<tr class="even">
<td align="left">EMEA</td>
<td align="left">Food &amp; Beverage</td>
<td align="right">4727420.5</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Electronics</td>
<td align="right">3377858.3</td>
</tr>
<tr class="even">
<td align="left">EMEA</td>
<td align="left">Electronics</td>
<td align="right">2476819.7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Home</td>
<td align="right">2368148.0</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">Tools</td>
<td align="right">2269642.1</td>
</tr>
<tr class="odd">
<td align="left">EMEA</td>
<td align="left">Tools</td>
<td align="right">1907109.1</td>
</tr>
<tr class="even">
<td align="left">EMEA</td>
<td align="left">Home</td>
<td align="right">1797324.2</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Baby</td>
<td align="right">1290893.9</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">Clothing</td>
<td align="right">1206610.8</td>
</tr>
<tr class="odd">
<td align="left">EMEA</td>
<td align="left">Baby</td>
<td align="right">1095900.8</td>
</tr>
<tr class="even">
<td align="left">EMEA</td>
<td align="left">Clothing</td>
<td align="right">913620.7</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span><span class="va">df_two</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 29.3 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Outlying Region by Sales is NA (16.4 M, 55.9 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`NA by Product`</span></span>
<span><span class="co">#&gt; In NA, significant Products by Sales are Food &amp; Beverage (5.8 M, 35.7 %), Electronics (3.4 M, 20.7 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (10.6 M, 36.1 %), Electronics (5.9 M, 20 %).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="depth">Depth<a class="anchor" aria-label="anchor" href="#depth"></a>
</h3>
<p>Narration depth can be controlled with <code>narration_depth</code>
argument. To get summary narratives only set
<code>narration_depth = 1</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>  <span class="va">df_two</span>, </span>
<span>  narration_depth <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 29.3 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Outlying Region by Sales is NA (16.4 M, 55.9 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (10.6 M, 36.1 %), Electronics (5.9 M, 20 %).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coverage">Coverage<a class="anchor" aria-label="anchor" href="#coverage"></a>
</h3>
<p>Key argument for all narratives is <code>coverage</code>. It is used
to narrate the most important things and avoid simple looping through
all of the dimension levels. <br><br> By default coverage is set to 0.5
and this means that narration will stop as soon as cumulative sum
reaches 50 % mark. With increased coverage, additional narrative is
returned.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_three</span> <span class="op">&lt;-</span> <span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Sales</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_three</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Share <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Sales</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    Cumulative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">Share</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Product</th>
<th align="right">Sales</th>
<th align="right">Share</th>
<th align="right">Cumulative</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Food &amp; Beverage</td>
<td align="right">12613552</td>
<td align="right">35.5</td>
<td align="right">35.5</td>
</tr>
<tr class="even">
<td align="left">Electronics</td>
<td align="right">7207901</td>
<td align="right">20.3</td>
<td align="right">55.8</td>
</tr>
<tr class="odd">
<td align="left">Home</td>
<td align="right">5172389</td>
<td align="right">14.6</td>
<td align="right">70.4</td>
</tr>
<tr class="even">
<td align="left">Tools</td>
<td align="right">5135457</td>
<td align="right">14.5</td>
<td align="right">84.9</td>
</tr>
<tr class="odd">
<td align="left">Baby</td>
<td align="right">2883246</td>
<td align="right">8.1</td>
<td align="right">93.0</td>
</tr>
<tr class="even">
<td align="left">Clothing</td>
<td align="right">2524937</td>
<td align="right">7.1</td>
<td align="right">100.1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span><span class="va">df_three</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Products is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %).</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span><span class="va">df_three</span>, coverage <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Products is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %), Home (5.2 M, 14.6 %).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="changing-templates">Changing Templates<a class="anchor" aria-label="anchor" href="#changing-templates"></a>
</h3>
<p>Template-based systems are based on calculations of individual
variables, and combining them together inside of the template. You can
return a list of calculated variables and full narrative
realization:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span><span class="va">df_three</span>, coverage <span class="op">=</span> <span class="fl">0.7</span>, return_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $narrative</span></span>
<span><span class="co">#&gt; $narrative$`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Products is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $narrative$`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %), Home (5.2 M, 14.6 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; $`Total Sales`$narrative_total</span></span>
<span><span class="co">#&gt; Total Sales across all Products is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Total Sales`$template_total</span></span>
<span><span class="co">#&gt; [1] "Total {measure} across all {pluralize(dimension_one)} is {total}."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Total Sales`$measure</span></span>
<span><span class="co">#&gt; [1] "Sales"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Total Sales`$dimension_one</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Total Sales`$total</span></span>
<span><span class="co">#&gt; [1] "35.5 M"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; $`Product by Sales`$narrative_outlier_final</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %), Home (5.2 M, 14.6 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$template_outlier_multiple</span></span>
<span><span class="co">#&gt; [1] "Outlying {pluralize(dimension)} by {measure} are {outlier_insight}."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$dimension</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$measure</span></span>
<span><span class="co">#&gt; [1] "Sales"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$outlier_insight</span></span>
<span><span class="co">#&gt; [1] "Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %), Home (5.2 M, 14.6 %)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$n_outliers</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$outlier_levels</span></span>
<span><span class="co">#&gt; [1] "Food &amp; Beverage" "Electronics"     "Home"           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$outlier_values</span></span>
<span><span class="co">#&gt; [1] "12.6 M" "7.2 M"  "5.2 M" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`$outlier_values_p</span></span>
<span><span class="co">#&gt; [1] "35.5 %" "20.3 %" "14.6 %"</span></span></code></pre></div>
<p>Let’s change a template for our narrative function and rework the
wording as well as changing ‘is’ to ‘are’ since <code>Sales</code> is
plural:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>  <span class="va">df_three</span>,</span>
<span>  template_total <span class="op">=</span> <span class="st">"Overall {measure} for all {pluralize(dimension_one)} are equal to {total}. "</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Overall Sales for all Products are equal to 35.5 M. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %).</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    template_outlier <span class="op">=</span> <span class="st">"Among {pluralize(dimension)} {outlier_levels} is an outlier, with {measure} of {outlier_values}, making it {outlier_values_p} of total."</span>,</span>
<span>    template_outlier_multiple <span class="op">=</span> <span class="st">"{outlier_levels} are the biggest {dimension} by {measure} with {outlier_values} or {outlier_values_p} share of total {measure} respectively."</span>,</span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>,</span>
<span>    dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="st">"Product"</span><span class="op">)</span>,</span>
<span>    coverage <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Among Regions NA is an outlier, with Sales of 16.4 M, making it 46 % of total.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`NA by Product`</span></span>
<span><span class="co">#&gt; In NA, significant Products by Sales are Food &amp; Beverage (5.8 M, 35.7 %), Electronics (3.4 M, 20.7 %).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Food &amp; Beverage and Electronics are the biggest Product by Sales with 12.6 M and 7.2 M or 35.5 % and 20.3 % share of total Sales respectively.</span></span></code></pre></div>
<div class="section level4">
<h4 id="r-environment">R Environment<a class="anchor" aria-label="anchor" href="#r-environment"></a>
</h4>
<p>We can set the templates using <code>usethis::edit_r_environ()</code>
or setting up an environment variable using your data science platform
capabilities.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"descriptive_template_total"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>  <span class="va">df_three</span>,</span>
<span>  template_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"descriptive_template_total"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A method that is a little more handy is setting
<code>.Renviron</code> variable names using a certain convention and
adding <code>use_renviron = TRUE</code> to the narrate function. For
example here we created a variable that uses the unique part of the
function name, underscore, and template name - <code>descriptive</code>
+ <code>-</code> + <code>template_total</code></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>  <span class="va">df_three</span>, </span>
<span>  use_renviron <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Products is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Product by Sales`</span></span>
<span><span class="co">#&gt; Outlying Products by Sales are Food &amp; Beverage (12.6 M, 35.5 %), Electronics (7.2 M, 20.3 %).</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="list-templates">List Templates<a class="anchor" aria-label="anchor" href="#list-templates"></a>
</h4>
<p>You can get all templates currently available in the package with
<code><a href="../reference/list_templates.html">list_templates()</a></code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_templates.html">list_templates</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="8%">
<col width="19%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th align="left">fun</th>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">template</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_total</td>
<td align="left">Total {measure} across all {pluralize(dimension_one)}
is {total}.</td>
</tr>
<tr class="even">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_average</td>
<td align="left">Average {measure} across all {pluralize(dimension_one)}
is {total}.</td>
</tr>
<tr class="odd">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_outlier</td>
<td align="left">Outlying {dimension} by {measure} is
{outlier_insight}.</td>
</tr>
<tr class="even">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_outlier_multiple</td>
<td align="left">Outlying {pluralize(dimension)} by {measure} are
{outlier_insight}.</td>
</tr>
<tr class="odd">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_outlier_l2</td>
<td align="left">In {level_l1}, significant {level_l2} by {measure} is
{outlier_insight}.</td>
</tr>
<tr class="even">
<td align="left">narrate_descriptive</td>
<td align="left">descriptive</td>
<td align="left">template_outlier_l2_multiple</td>
<td align="left">In {level_l1}, significant {pluralize(level_l2)} by
{measure} are {outlier_insight}.</td>
</tr>
<tr class="odd">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_total</td>
<td align="left">From {timeframe_prev} to {timeframe_curr}, {measure}
{trend} by {change_ytd}</td>
</tr>
<tr class="even">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_average</td>
<td align="left">Average {measure} across all {pluralize(dimension_one)}
is {total}.</td>
</tr>
<tr class="odd">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_outlier</td>
<td align="left">Outlying {dimension} by {measure} is
{outlier_insight}.</td>
</tr>
<tr class="even">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_outlier_multiple</td>
<td align="left">Outlying {pluralize(dimension)} by {measure} are
{outlier_insight}.</td>
</tr>
<tr class="odd">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_outlier_l2</td>
<td align="left">In {level_l1}, significant {level_l2} by {measure} is
{outlier_insight}.</td>
</tr>
<tr class="even">
<td align="left">narrate_trend</td>
<td align="left">trend</td>
<td align="left">template_outlier_l2_multiple</td>
<td align="left">In {level_l1}, significant {pluralize(level_l2)} by
{measure} are {outlier_insight}.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="average-vs-others">Average vs Others<a class="anchor" aria-label="anchor" href="#average-vs-others"></a>
</h4>
<p>When <code>summarization</code> is set to <code>average</code> the
way of output calculation is significantly different. Generally better
way of using it in your outputs is using different templates for
different summarization types.</p>
<p>Giving users control over template creation and avoiding strict
ruling for how they should look does introduce some additional
complexity.</p>
<p>For example, if we use a <code>template_outlier</code> for default
<code>summarization = "sum"</code> we get a great descriptive
narrative:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    template_outlier <span class="op">=</span> <span class="st">"Among {pluralize(dimension)} {outlier_levels} is an outlier, with {measure} of {outlier_values}, making it {outlier_values_p} of total."</span>,</span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>,</span>
<span>    dimensions <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    coverage <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Total Sales`</span></span>
<span><span class="co">#&gt; Total Sales across all Regions is 35.5 M.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Among Regions NA is an outlier, with Sales of 16.4 M, making it 46 % of total.</span></span></code></pre></div>
<p>But when trying the same for <code>summarization = "average"</code>
we get into trouble, because for this case we compare the values for
every level to the overall average Sales. Default templates handle that
using logic in the <code>{outlier_insight}</code> calculation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    template_outlier <span class="op">=</span> <span class="st">"Among {pluralize(dimension)} {outlier_levels} is an outlier, with {measure} of {outlier_values}, making it {outlier_values_p} of total."</span>,</span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>,</span>
<span>    dimensions <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    summarization <span class="op">=</span> <span class="st">"average"</span>,</span>
<span>    coverage <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Average Sales`</span></span>
<span><span class="co">#&gt; Average Sales across all Regions is 3,553.7.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Among Regions LATAM is an outlier, with Sales of 2,056.4, making it -42.1 % of total.</span></span></code></pre></div>
<p>So here we can using something like this:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/narrate_descriptive.html">narrate_descriptive</a></span><span class="op">(</span></span>
<span>    template_outlier <span class="op">=</span> <span class="st">"Among {pluralize(dimension)} {outlier_levels} is an outlier, with average {measure} of {outlier_values}, {outlier_values_p} lower than average {measure} across all records."</span>,</span>
<span>    measure <span class="op">=</span> <span class="st">"Sales"</span>,</span>
<span>    dimensions <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    summarization <span class="op">=</span> <span class="st">"average"</span>,</span>
<span>    coverage <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Average Sales`</span></span>
<span><span class="co">#&gt; Average Sales across all Regions is 3,553.7.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Region by Sales`</span></span>
<span><span class="co">#&gt; Among Regions LATAM is an outlier, with average Sales of 2,056.4, -42.1 % lower than average Sales across all records.</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Denis Abdullin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
